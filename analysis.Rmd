---
title: "Multimedia Meta-analysis Scripts"
date: "Updated: `r format(Sys.Date(), format='%B %d, %Y')`"
output:
  html_document:
    toc: true
    toc_depth: 5
    number_sections: no
---

<br/>


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.retina = 4)
```

```{r}
# Libraries
pacman::p_load(metafor, readxl, MAd, metaforest, dmetar, DT, robumeta, janitor, tidyverse, texreg, effectsize, skimr)

# Parameters
data_file <- here::here("data", "Multimedia Meta Data.xlsx")

# effectsize::t_to_d(2.22, 139)
# dmetar::se.from.p(effect.size = 0.38, p = 0.028, N = 141) %>% transmute(EV = round(StandardError * StandardError, 4))
```



```{r}
#### Directly entered ES

df_es1 <-
  read_xlsx(data_file, sheet = "Effect Size Only 1") %>% 
  transmute(
    study_id = STUDYID,
    type = str_sub(Outcome, 1, 3),
    ES,
    EV
  ) %>% 
  remove_empty()

df_es2 <-
  read_xlsx(data_file, sheet = "Effect Size Only 2") %>% 
  remove_empty() %>% 
  transmute(
    study_id = STUDYID,
    type = str_sub(Outcome, 1, 3),
    ES,
    EV
  ) %>% 
  remove_empty()

  
df_es3 <-
  read_xlsx(data_file, sheet = "Effect Size Only 3") %>% 
  transmute(study_id = STUDYID, type = str_sub(Outcome, 1, 3), ES = ES1, EV = se1 * se1) %>%
  bind_rows(
    read_xlsx(data_file, sheet = "Effect Size Only 3") %>% 
      transmute(study_id = STUDYID, type = str_sub(Outcome, 1, 3), ES = ES2, EV = se2 * se2)
  )

df_es4 <-
  read_xlsx(data_file, sheet = "Effect Size Only 4") %>% 
  remove_empty() %>% 
  transmute(
    study_id = STUDYID,
    type = str_sub(Outcome, 1, 3),
    ES,
    EV
  ) %>% 
  remove_empty()

df_es5 <-
  read_xlsx(data_file, sheet = "Effect Size Only 5") %>% 
  remove_empty() %>% 
  transmute(
    study_id = STUDYID,
    type = str_sub(Outcome, 1, 3),
    ES,
    EV
  ) %>% 
  remove_empty()

df_es6 <-
  read_xlsx(data_file, sheet = "Effect Size Only 6") %>% 
  remove_empty() %>% 
  transmute(
    study_id = STUDYID,
    type,
    ES,
    EV
  ) %>% 
  remove_empty()

df_es_direct <-
  bind_rows(df_es1, df_es2, df_es3, df_es4, df_es5, df_es6) %>% 
  inner_join(
    read_xlsx(data_file, sheet = "All Studies") %>% 
      select(study_id = `STUDYID`, AUTYR = `Author (Year)`) %>% 
      drop_na(AUTYR),
    by = "study_id"
  )
```


```{r}
### Load all data

df_raw <-
  bind_rows(
    "DSN" = read_xlsx(data_file, sheet = "Decoding-DSN") %>% rename_at(vars(-c(1:2)), ~ str_replace(., "DSN", "")),
    "DRD" = read_xlsx(data_file, sheet = "Decoding-DRD") %>% rename_at(vars(-c(1:2)), ~ str_replace(., "DRD", "")),
    "DRP" = read_xlsx(data_file, sheet = "Decoding-DRP") %>% rename_at(vars(-c(1:2)), ~ str_replace(., "DRP", "")),
    "LSN" = read_xlsx(data_file, sheet = "Linguistic Comprehension-LSN") %>% rename_at(vars(-c(1:2)), ~ str_replace(., "LSN", "")),
    "LRD" = read_xlsx(data_file, sheet = "Linguistic Comprehension-LRD") %>% rename_at(vars(-c(1:2)), ~ str_replace(., "LRD", "")),
    "LRP" = read_xlsx(data_file, sheet = "Linguistic Comprehension-LRP") %>% rename_at(vars(-c(1:2)), ~ str_replace(., "LRP", "")),
    "CSN" = read_xlsx(data_file, sheet = "Reading Comprehension-CSN") %>% rename_at(vars(-c(1:2)), ~ str_replace(., "CSN", "")),
    "CRD" = read_xlsx(data_file, sheet = "Reading Comprehension-CRD") %>% rename_at(vars(-c(1:2)), ~ str_replace(., "CRD", "")),
    "WPSN" = read_xlsx(data_file, sheet = "Writing Proficiency-WPSN") %>% rename_at(vars(-c(1:2)), ~ str_replace(., "WPSN", "")),
    "WPRD" = read_xlsx(data_file, sheet = "Writing Proficiency-WPRD") %>% rename_at(vars(-c(1:2)), ~ str_replace(., "WPRD", "")),
    .id = "type"
  ) %>% 
  rename(study_id = `STUDYID`) %>%
  drop_na(study_id) %>%
  anti_join(df_es6, by = c("type", "study_id")) %>%
  bind_rows(
    .,
    bind_rows(
      "DSN" = read_xlsx(data_file, sheet = "New Postonly") %>% rename_at(vars(-c(1:2)), ~ str_replace(., "DSN", "")),
      "DSN" = read_xlsx(data_file, sheet = "New Prepost") %>% rename_at(vars(-c(1:2)), ~ str_replace(., "DSN", "")),
      # "LSN" = read_xlsx(data_file, sheet = "New Prepost 2") %>% rename_at(vars(-c(1:2)), ~ str_replace(., "LSN", "")),
      .id = "type"
    )
  ) %>%
  remove_empty() %>%
  select(-`Author (Year)`) %>% 
  select(study_id, type, sort(current_vars()))
```


```{r}
# HLM data

df_hlm1 <-
  read_xlsx(data_file, sheet = "HLM Effects 1") %>% 
  mutate(
    type = str_sub(Outcome, 1, 3),
    msr = str_sub(Outcome, 4, 4),
  ) %>% 
  select(-c(Notes, `Author (Year)`, Outcome, Measure)) %>% 
  rename(study_id = `STUDYID`) %>%
  drop_na(study_id) %>%
  select(study_id, type, msr, sort(current_vars())) %>% 
  remove_empty() %>% 
  pivot_wider(names_from = msr, values_from = c(-study_id, -type, -msr)) %>% 
  remove_empty()

df_hlm2 <-
  read_xlsx(data_file, sheet = "HLM Effects 2") %>% 
  mutate(
    type = str_sub(Outcome, 1, 3),
    msr = str_sub(Outcome, 4, 4),
  ) %>% 
  select(-c(Notes, `Author (Year)`, Outcome, Measure)) %>% 
  rename(study_id = `STUDYID`) %>%
  drop_na(study_id) %>%
  select(study_id, type, msr, sort(current_vars())) %>% 
  remove_empty() %>% 
  pivot_wider(names_from = msr, values_from = c(-study_id, -type, -msr)) %>% 
  remove_empty()


df_hlm3 <-
  read_xlsx(data_file, sheet = "HLM Effects 3") %>% 
  mutate(
    type = str_sub(Outcome, 1, 3),
    msr = str_sub(Outcome, 4, 4),
  ) %>% 
  select(-c(Notes, `Author (Year)`, Outcome, Measure)) %>% 
  rename(study_id = `STUDYID`) %>%
  drop_na(study_id) %>%
  select(study_id, type, msr, sort(current_vars())) %>% 
  remove_empty() %>% 
  pivot_wider(names_from = msr, values_from = c(-study_id, -type, -msr)) %>% 
  remove_empty()


df_hlm4 <-
  read_xlsx(data_file, sheet = "HLM Effects 4") %>% 
  mutate(
    type = str_sub(Outcome, 1, 3),
    msr = str_sub(Outcome, 4, 4),
  ) %>% 
  select(-c(Notes, `Author (Year)`, Outcome, Measure)) %>% 
  rename(study_id = `STUDYID`) %>%
  drop_na(study_id) %>%
  select(study_id, type, msr, sort(current_vars())) %>% 
  remove_empty() %>% 
  pivot_wider(names_from = msr, values_from = c(-study_id, -type, -msr)) %>% 
  remove_empty()


df_hlm5 <-
  read_xlsx(data_file, sheet = "HLM Effects 5") %>% 
  select(-c("Coefficient from HLM", "se", "Pooled student level sd", "effect size")) %>% 
  mutate(
    type = str_sub(Outcome, 1, 3),
    msr = str_sub(Outcome, 4, 4),
  ) %>% 
  select(-c(Notes, `Author (Year)`, Outcome, Measure)) %>% 
  rename(study_id = `STUDYID`) %>%
  drop_na(study_id) %>%
  select(study_id, type, msr, sort(current_vars())) %>% 
  remove_empty() %>% 
  pivot_wider(names_from = msr, values_from = c(-study_id, -type, -msr)) %>% 
  remove_empty()


df_hlm <- 
  bind_rows(df_hlm1, df_hlm2, df_hlm3, df_hlm4, df_hlm5) %>%
  mutate(type = str_c(type, "HLM", sep = "-")) %>%
  rename(
    C11MPost = C1MPost_1,
    C21MPost = C1MPost_2,
    C31MPost = C1MPost_3, 
    C41MPost = C1MPost_4, 
    C51MPost = C1MPost_5, 
    C61MPost = C1MPost_6, 
    C11MPre  = C1MPre_1,  
    C11NPost = C1NPost_1,
    C21NPost = C1NPost_2, 
    C31NPost = C1NPost_3, 
    C41NPost = C1NPost_4,
    C51NPost = C1NPost_5, 
    C61NPost = C1NPost_6, 
    C11NPre = C1NPre_1,  
    C11SPost = C1SPost_1, 
    C21SPost = C1SPost_2, 
    C31SPost = C1SPost_3, 
    C41SPost = C1SPost_4,
    C51SPost = C1SPost_5, 
    C61SPost = C1SPost_6, 
    C11SPre = C1SPre_1,  
    T11MPost = T1MPost_1, 
    T21MPost = T1MPost_2, 
    T31MPost = T1MPost_3, 
    T41MPost = T1MPost_4, 
    T51MPost = T1MPost_5, 
    T61MPost = T1MPost_6, 
    T11MPre = T1MPre_1, 
    T11NPost = T1NPost_1, 
    T21NPost = T1NPost_2, 
    T31NPost = T1NPost_3, 
    T41NPost = T1NPost_4, 
    T51NPost = T1NPost_5, 
    T61NPost = T1NPost_6, 
    T11NPre = T1NPre_1,  
    T11SPost = T1SPost_1, 
    T21SPost = T1SPost_2, 
    T31SPost = T1SPost_3,
    T41SPost = T1SPost_4, 
    T51SPost = T1SPost_5, 
    T61SPost = T1SPost_6, 
    T11SPre = T1SPre_1,  
    C21MPre = C1MPre_2, 
    C41MPre = C1MPre_4,  
    C21NPre = C1NPre_2,  
    C41NPre = C1NPre_4,  
    C21SPre = C1SPre_2,  
    C41SPre = C1SPre_4,
    T21MPre = T1MPre_2,  
    T41MPre = T1MPre_4,  
    T21NPre = T1NPre_2, 
    T41NPre = T1NPre_4,  
    T21SPre = T1SPre_2, 
    T41SPre = T1SPre_4, 
    C31MPre = C1MPre_3,  
    C31NPre = C1NPre_3,  
    C31SPre = C1SPre_3,  
    T31MPre = T1MPre_3,
    T31NPre = T1NPre_3,  
    T31SPre = T1SPre_3 
  ) %>% 
  remove_empty()

# remove redundant dfs
rm(df_hlm1, df_hlm2, df_hlm3, df_hlm4, df_hlm5)
rm(df_es1, df_es2, df_es3, df_es4, df_es5, df_es6)
```


```{r}
df_raw <- bind_rows(df_raw, df_hlm)

# remove redundant rows
df_raw$na_count <- apply(df_raw, 1, function(x) sum(is.na(x)))
#df_raw %>% filter(na_count >= (ncol(df_raw) - 3)) %>% remove_empty()
df_raw <- df_raw %>% filter(na_count < (ncol(df_raw) - 3))

#df_raw %>% arrange(-na_count) %>% count(na_count) %>% mutate(na_count = na_count/3)
#head(1) %>% remove_empty() %>% glimpse()
```


```{r, eval=FALSE}
# general checks
df_raw %>% get_dupes()
df_raw %>% count(type)
df_raw %>% summarize_at(vars(1, 2, 210), ~ mean(is.na(.)))
df_raw %>% get_dupes(type, study_id) %>% remove_empty()
```


### Study and measure overview

```{r}
# Add in correct author (year)
df_raw <-
  df_raw %>% 
  inner_join(
    read_xlsx(data_file, sheet = "All Studies") %>% 
      select(study_id = `STUDYID`, AUTYR = `Author (Year)`) %>% 
      drop_na(AUTYR),
    by = "study_id"
  ) %>% 
  relocate(type, study_id, AUTYR) %>% 
  arrange(type, study_id, AUTYR)

df_raw %>%
  mutate(
    type = if_else(type == "WCSN", "DSN", type),
    type = if_else(type == "WCRD", "DRD", type),
  ) %>% 
  distinct(AUTYR, type) %>% 
  arrange(AUTYR, type) %>% 
  group_by(AUTYR) %>% 
  mutate(n = row_number()) %>%
  ungroup() %>% 
  pivot_wider(names_from = n, values_from = type, names_prefix = "Measure ") %>% 
  rename(`Author (Year)` = AUTYR) %>% 
  datatable()
```

---

<br/>

### Calculating effect sizes


```{r}
### Post only

df_post <- df_raw

for (a in 1:9) {
  for (t in 1:9) {
    for (c in 1:9) {
      if (
        str_glue("T{t}{a}MPost") %in% colnames(df_post) & 
        str_glue("C{c}{a}MPost") %in% colnames(df_post)
      ) {
        df_post <-
          escalc(
            data = df_post,
            measure = "SMD",
            m1i = df_post[, str_c("T", t, a, "MPost")] %>% unlist(),
            m2i = df_post[, str_c("C", c, a, "MPost")] %>% unlist(),
            sd1i = df_post[, str_c("T", t, a, "SPost")] %>% unlist(),
            sd2i = df_post[, str_c("C", c, a, "SPost")] %>% unlist(),
            n1i = df_post[, str_c("T", t, a, "NPost")] %>% unlist(),
            n2i = df_post[, str_c("C", c, a, "NPost")] %>% unlist(),
            var.names = c(str_glue("ES{a}_{t}{c}"), str_glue("EV{a}_{t}{c}"))
          )
      }
    }
  }
}

df_post <-
  df_post %>% 
  select(study_id, AUTYR, type, starts_with("ES")) %>%
  pivot_longer(cols = starts_with("ES"), names_to = "num", values_to = "ES", values_drop_na = T) %>%
  mutate(num = str_sub(num, 3)) %>% 
  left_join(
    df_post %>% 
      select(study_id, AUTYR, type, starts_with("EV")) %>% 
      pivot_longer(cols = starts_with("EV"), names_to = "num", values_to = "EV", values_drop_na = T) %>% 
      mutate(num = str_sub(num, 3)),
    by = c("study_id", "AUTYR", "type", "num")
  )
```




```{r}
# Pre and Post

df_prepost <- df_raw

# treatment (post-pre)
for (a in 1:9) {
  for (t in 1:9) {
    if (str_glue("T{t}{a}MPost") %in% colnames(df_prepost) & str_glue("T{t}{a}MPre") %in% colnames(df_prepost)) {
      df_prepost <-
        escalc(
          data = df_prepost,
          measure = "SMCR",
          m1i = df_prepost[, str_c("T", t, a, "MPost")] %>% unlist(),
          m2i = df_prepost[, str_c("T", t, a, "MPre")] %>% unlist(),
          sd1i = df_prepost[, str_c("T", t, a, "SPre")] %>% unlist(),
          ni = df_prepost[, str_c("T", t, a, "NPost")] %>% unlist(),
          ri = rep(0.5, 183),
          var.names = c(str_glue("TES{a}_{t}"), str_glue("TEV{a}_{t}"))
        )
    }
  }
}

# control (post-pre)
for (a in 1:9) {
  for (c in 1:9) {
    if (str_glue("C{c}{a}MPost") %in% colnames(df_prepost) & str_glue("C{c}{a}MPre") %in% colnames(df_prepost)) {
      df_prepost <-
        escalc(
          data = df_prepost,
          measure = "SMCR",
          m1i = df_prepost[, str_c("C", c, a, "MPost")] %>% unlist(),
          m2i = df_prepost[, str_c("C", c, a, "MPre")] %>% unlist(),
          sd1i = df_prepost[, str_c("C", c, a, "SPre")] %>% unlist(),
          ni = df_prepost[, str_c("C", c, a, "NPost")] %>% unlist(),
          ri = rep(0.5, 183),
          var.names = c(str_glue("CES{a}_{c}"), str_glue("CEV{a}_{c}"))
        )
    }
  }
}



# ES and EV taken together
for (a in 1:9) {
  for (t in 1:9) {
    for (c in 1:9) {
      if (
        !(str_glue("TES{a}_{t}") %in% colnames(df_prepost)) | 
        !(str_glue("TEV{a}_{t}") %in% colnames(df_prepost)) |
        !(str_glue("CES{a}_{c}") %in% colnames(df_prepost)) | 
        !(str_glue("CEV{a}_{c}") %in% colnames(df_prepost))
      ) {
        next
      }
      # subtracting effect size
      df_prepost[, str_c("ES", a, "_", t, c)] <- 
        (df_prepost[, str_c("TES", a, "_", t)] %>% unlist()) -
        (df_prepost[, str_c("CES", a, "_", c)] %>% unlist())
      # adding variance
      df_prepost[, str_c("EV", a, "_", t, c)] <- 
        (df_prepost[, str_c("TEV", a, "_", t)] %>% unlist()) +
        (df_prepost[, str_c("CEV", a, "_", c)] %>% unlist())
    }
  }
}

df_prepost <-
  df_prepost %>% 
  select(study_id, AUTYR, type, starts_with("ES")) %>% 
  pivot_longer(cols = starts_with("ES"), names_to = "num", values_to = "ES", values_drop_na = T) %>%
  mutate(num = str_sub(num, 3)) %>% 
  left_join(
    df_prepost %>%
      select(study_id, AUTYR, type, starts_with("EV")) %>% 
      pivot_longer(cols = starts_with("EV"), names_to = "num", values_to = "EV", values_drop_na = T) %>% 
      mutate(num = str_sub(num, 3)),
    by = c("study_id", "AUTYR", "type", "num")
  )
```


```{r}
df_es_calc <-
  full_join(df_prepost, df_post, by = c("study_id", "AUTYR", "type", "num")) %>% 
  mutate(
    ES.x = if_else(is.na(ES.x) & !is.na(ES.y), ES.y, ES.x),
    EV.x = if_else(is.na(EV.x) & !is.na(EV.y), EV.y, EV.x)
  ) %>% 
  select(study_id, AUTYR, type, ES = ES.x, EV = EV.x)

# anti_join(df_post, df_prepost, by = c("study_id", "AUTYR", "type", "num")) %>% count(study_id)
```



```{r, fig.retina=4}
#### Combining all
df_append <- 
  bind_rows(df_es_calc, df_es_direct) %>% 
  mutate(
    type = if_else(type == "WCSN", "DSN", type),  # fixing WCSN --> DSN
    type = if_else(type == "WCRD", "DRD", type),  # fixing WCRD --> DRD
    type = str_replace(type, "-HLM", ""), # removing HLM as separate sub-type
  ) %>%
  arrange(type, study_id) %>%
  select(type, stdid = study_id, AUTYR, everything()) %>% 
  distinct()

cor_es <-
  df_append %>%
  unite("type_stdid", c("type", "stdid")) %>% 
  agg(id = type_stdid, es = ES, var = EV, method = "BHHR", data = .) %>% 
  separate(id, c("type", "stdid")) %>% 
  rename(ES = es, EV = var)

df_clean <-
  df_append %>% 
  distinct(type, stdid, AUTYR) %>%
  mutate(stdid = as.character(stdid)) %>% 
  left_join(cor_es, by = c("type", "stdid")) %>% 
  mutate_if(is.character, ~ str_replace_all(., '[\n\t]', '')) %>% 
  arrange(type, stdid)

rm(df_es_calc, df_es_direct, df_post, df_prepost, cor_es, df_raw, df_hlm, a, c, t)
```


```{r}
## add moderators ##

moderators <-
  read_xlsx(here::here("data/Revised Tables.xlsx")) %>%
  remove_empty() %>% 
  clean_names() %>% 
  transmute(
    stdid = as.character(studyid),
    outside_us = if_else(outside_us == "Yes", 1L, 0L),
    low_income_included = if_else(lowinc33 == "Yes", 1L, 0L),
    second_lang_included = if_else(seclang33 == "Yes", 1L, 0L),
    stu_disability_included = if_else(stdis33 == "Yes", 1L, 0L),
    grade = case_when(
      k == 1 ~ "K-2",
      gr1 == 1 ~ "K-2",
      gr2 == 1 ~ "K-2",
      gr3 == 1 ~ "3-5",
      gr4 == 1 ~ "3-5",
      gr5 == 1 ~ "3-5",
      TRUE ~ NA_character_
    ) %>% factor(levels = c("3-5", "K-2")),
    pedagogy = case_when(
      pedagogy == 1 ~ "Behavioral",
      pedagogy == 2 ~ "Cognitive",
      pedagogy == 3 ~ "Constructivist",
      TRUE ~ NA_character_
    ) %>% factor(levels = c("Behavioral", "Cognitive", "Constructivist")),
    instructional_context = case_when(
      ins_cont_i0 == 0 ~ "Individual only",
      ins_cont_i0 == 1 ~ "Other than individual",
      TRUE ~ NA_character_
    ) %>% factor(levels = c("Individual only", "Other than individual")),
    tech_plus1,
    typetech = typetech %>% factor(levels = c("CAI", "ER", "Other")),
    gamification = if_else(gamification == "Yes", 1L, 0L),
    adaptivity = if_else(adaptivity == "Yes", 1L, 0L),
    feedback = if_else(feedback == "Yes", 1L, 0L),
    teach_tr = if_else(teach_tr == "Yes", 1L, 0L),
    design = design %>% factor(levels = c("QED", "RCT")),
    control = control %>% factor(levels = c("ALT", "BAU")),
    avghrs,
    avghrs_categories = ntile(avghrs, 3),
    avghrs_categories =
      if_else(avghrs_categories == 1, 'Low', if_else(avghrs_categories == 2, 'Medium', 'High')) %>%
      factor(levels = c("Low", "Medium", "High"))
  )


df_clean <-
  df_clean %>%
  left_join(moderators, by = "stdid") %>%
  relocate(type, stdid, AUTYR) %>%
  arrange(type, stdid, AUTYR)

rm(moderators)
```



```{r}
#### Filtered datasets
df_c <- df_clean %>% filter(type %in% c("CRD", "CRP", "CSN"))
df_d <- df_clean %>% filter(type %in% c("DRD", "DRP", "DSN"))
df_l <- df_clean %>% filter(type %in% c("LRD", "LRP", "LSN"))
df_w <- df_clean %>% filter(type %in% c("WPRD", "WPSN"))
```



```{r}
# displaying clean df

df_clean %>%
  relocate(AUTYR, stdid) %>%
  arrange(AUTYR, type) %>% 
  select(`Author (Year)` = AUTYR, type, ES, EV) %>% 
  mutate_if(is.numeric, ~ round(., 4)) %>% 
  datatable()
```


---

<br/>

### Synthesizing effect sizes

#### Code-related

```{r}
model_d <-
  df_d %>%
  mutate(type = factor(type, levels = c("DRP", "DRD", "DSN"))) %>% 
  mutate(
    AUTYR = if_else(str_detect(type, "D$"), str_c(AUTYR, " "), AUTYR),
    AUTYR = if_else(str_detect(type, "N$"), str_c(AUTYR, "  "), AUTYR),
  ) %>%
  arrange(desc(type), desc(ES)) %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    slab = AUTYR
  )

model_dr <-
  df_d %>%
  filter(str_detect(type, "^DR")) %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    slab = stdid
  )

model_drp <-
  df_d %>%
  filter(type == "DRP") %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    slab = stdid
  )

model_drd <-
  df_d %>%
  filter(type == "DRD") %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    slab = stdid
  )

model_dsn <-
  df_d %>%
  filter(type == "DSN") %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    slab = stdid
  )

# df_d %>% mutate(type = factor(type, levels = c("DRP", "DRD", "DSN"))) %>% count(type)
# df_d %>% arrange(type, ES)
```

Overall:

```{r}
model_d
```


Researcher-Developed proximal:

```{r}
model_drp
```

Researcher-Developed distal:

```{r}
model_drd
```

Researcher-Developed (all):

```{r}
model_dr
```

Standardized:

```{r}
model_dsn
```


```{r, fig.retina = 4, fig.asp=3}
a1 <- 4
a2 <- 4 + nrow(df_d %>% filter(type == "DSN")) - 1

b1 <- a2 + 6
b2 <- b1 + nrow(df_d %>% filter(type == "DRD")) - 1

c1 <- b2 + 6
c2 <- c1 + nrow(df_d %>% filter(type == "DRP")) - 1

forest(
  model_d,
  xlab = "Code Related Skills",
  addcred = T, 
  header = T,
  xlim = c(-6, 6),
  ylim = c(0, c2 + 6),
  rows = c(a1:a2, b1:b2, c1:c2),
  pch = 21,
  bg = "grey",
  lwd = 1.5
)

op <- par(cex = 1.25, font = 4)

text(-6, c(a2 + 2, b2 + 2, c2 + 2), pos = 4, c("Standardized", "Researcher-Developed (Distal)", "Researcher-Developed (Proximal)"))

addpoly(model_drp, row = b2 + 4, cex = 1.25, col = "white", lwd = 3)
addpoly(model_drd, row = a2 + 4, cex = 1.25, col = "white", lwd = 3)
addpoly(model_dsn, row = 2, cex = 1.25, col = "white", lwd = 3)
```

---

<br/>

#### Reading Comprehension

```{r}
model_c <-
  df_c %>%
  mutate(type = factor(type, levels = c("CRP", "CRD", "CSN"))) %>% 
  mutate(
    AUTYR = if_else(str_detect(type, "N$"), str_c(AUTYR, " "), AUTYR),
  ) %>%
  arrange(desc(type), desc(ES)) %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    slab = AUTYR
  )


model_cr <-
  df_c %>%
  filter(str_detect(type, "^CR")) %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    slab = stdid
  )

model_csn <-
  df_c %>%
  filter(type == "CSN") %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    slab = stdid
  )
```


Overall:

```{r}
model_c
```


Researcher-Developed (Distal):

```{r}
model_cr
```

Standardized:

```{r}
model_csn
```



```{r, fig.retina = 4, fig.asp=3}
a1 <- 4
a2 <- 4 + nrow(df_c %>% filter(type == "CSN")) - 1

b1 <- a2 + 6
b2 <- b1 + nrow(df_c %>% filter(type == "CRD")) - 1

forest(
  model_c,
  xlab = "Reading Comprehension Skills",
  addcred = T, 
  header = T,
  xlim = c(-6, 5),
  ylim = c(0, b2 + 6),
  rows = c(a1:a2, b1:b2),
  pch = 21,
  bg = "grey",
  lwd = 1.5
)

op <- par(cex = 1.25, font = 4)

text(-6, c(a2 + 2, b2 + 2), pos = 4, c("Standardized", "Researcher-Developed (Distal)"))

addpoly(model_cr, row = a2 + 4, cex = 1.25, col = "white", lwd = 3)
addpoly(model_csn, row = 2, cex = 1.25, col = "white", lwd = 3)
```



---

<br/>


#### Language-focused

```{r}
model_l <-
  df_l %>%
  mutate(type = factor(type, levels = c("LRP", "LRD", "LSN"))) %>%
  mutate(
    AUTYR = if_else(str_detect(type, "D$"), str_c(AUTYR, " "), AUTYR),
    AUTYR = if_else(str_detect(type, "N$"), str_c(AUTYR, "  "), AUTYR),
  ) %>% 
  arrange(desc(type), desc(ES)) %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    slab = AUTYR
  )

model_lr <-
  df_l %>%
  filter(str_detect(type, "^LR")) %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    slab = stdid
  )

model_lrd <-
  df_l %>%
  filter(type == "LRD") %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    slab = stdid
  )

model_lrp <-
  df_l %>%
  filter(type == "LRP") %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    slab = stdid
  )

model_lsn <-
  df_l %>%
  filter(type == "LSN") %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    slab = stdid
  )

# df_l %>% arrange(type, ES)
# df_l %>% mutate(type = factor(type, levels = c("LRP", "LRD", "LSN"))) %>% count(type)
```


Overall:

```{r}
model_l
```


Researcher-Developed proximal:

```{r}
model_lrp
```

Researcher-Developed distal:

```{r}
model_lrd
```

Researcher-Developed (all):

```{r}
model_lr
```

Standardized:

```{r}
model_lsn
```




```{r, fig.retina = 4, fig.asp=3}
a1 <- 4
a2 <- 4 + nrow(df_l %>% filter(type == "LSN")) - 1

b1 <- a2 + 6
b2 <- b1 + nrow(df_l %>% filter(type == "LRD")) - 1

c1 <- b2 + 6
c2 <- c1 + nrow(df_l %>% filter(type == "LRP")) - 1

forest(
  model_l,
  xlab = "Language Focused Skills",
  addcred = T, 
  header = T,
  xlim = c(-7, 7),
  ylim = c(0, c2 + 6),
  rows = c(a1:a2, b1:b2, c1:c2),
  pch = 21,
  bg = "grey",
  lwd = 1.5
)

op <- par(cex = 1.25, font = 4)

text(-7, c(a2 + 2, b2 + 2, c2 + 2), pos = 4, c("Standardized", "Researcher-Developed (Distal)", "Researcher-Developed (Proximal)"))

addpoly(model_lrp, row = b2 + 4, cex = 1.25, col = "white", lwd = 3)
addpoly(model_lrd, row = a2 + 4, cex = 1.25, col = "white", lwd = 3)
addpoly(model_lsn, row = 2, cex = 1.25, col = "white", lwd = 3)
```



---

<br/>

#### Writing Proficiency

```{r}
model_w <-
  df_w %>%
  arrange(desc(type), desc(ES)) %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    slab = AUTYR
  )

model_wprd <-
  df_w %>%
  filter(type == "WPRD") %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    slab = stdid
  )

model_wpsn <-
  df_w %>%
  filter(type == "WPSN") %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    slab = stdid
  )

# df_w %>% arrange(type, ES)
```



Overall:

```{r}
model_w
```


Researcher-Developed distal:

```{r}
model_wprd
```


Standardized:

```{r}
model_wpsn
```



```{r, fig.retina = 4, fig.asp = 1}
a1 <- 4
a2 <- 4 + nrow(df_w %>% filter(type == "WPSN")) - 1

b1 <- a2 + 6
b2 <- b1 + nrow(df_w %>% filter(type == "WPRD")) - 1

forest(
  model_w,
  xlab = "Writing Skills",
  addcred = T, 
  header = T,
  xlim = c(-4, 5),
  ylim = c(-2, b2 + 6),
  rows = c(a1:a2, b1:b2),
  pch = 21,
  bg = "grey",
  lwd = 1.5
)

op <- par(cex = 1.25, font = 4)

text(-4, c(a2 + 2, b2 + 2), pos = 4, c("Standardized", "Researcher-Developed (Distal)"))

addpoly(model_wprd, row = a2 + 4, cex = 1.25, col = "white", lwd = 3)
addpoly(model_wpsn, row = 2, cex = 1.25, col = "white", lwd = 3)
```


---

<br/>

### Moderator analyses

Descriptive summary of moderator variables used:

```{r}
df_clean %>% 
  select(6:21) %>%
  skim()
```

---

<br/><br/>

#### Comparing Across Outcomes (Code-related/ReadingComp/LanguageComp/Writing)

```{r}
df_clean %>%
  mutate(
    outcome = case_when(
      str_detect(type, "^D") ~ "Code-related",
      str_detect(type, "^C") ~ "Reading Comp",
      str_detect(type, "^L") ~ "Language Comp",
      str_detect(type, "^W") ~ "Writing",
      TRUE ~ NA_character_
    ) %>% 
    factor(levels = c("Code-related", "Reading Comp", "Language Comp", "Writing")),
  ) %>% 
  rma(yi = ES, vi = EV, data = ., method = "REML", mods = ~ outcome)
```


---

<br/><br/>

#### Code-related

Measure type (Custom distal, Custom proximal, Standardized):

```{r}
rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ type)
```


Location outside of the U.S.:

```{r}
rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ outside_us)
```

Students from low-income backgrounds included:

```{r}
rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ low_income_included)
```

Students learning a second or other language included:

```{r}
rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ second_lang_included)
```

Students with disabilities included:

```{r}
rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ stu_disability_included)
```

Grade level K-2 vs. 3-5:

```{r}
rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ grade)
```

Pedagogical Orientation: Behavorial, Cognitive, Constructivist:

```{r}
rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ pedagogy)
```

Technology Only (T) or Technology Plus (T+):

```{r}
rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ tech_plus1)
```

Type of technology (CAI, ER, Other):

```{r}
rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ typetech)
```


Gamification Discussed (yes/no):

```{r}
rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ gamification)
```

Adaptivity Discussed (yes/no):

```{r}
rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ adaptivity)
```

Feedback Discussed (yes/no):

```{r}
rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ feedback)
```

Instructional Context:

```{r}
rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ instructional_context)
```

Teacher Training Discussed:

```{r}
rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ teach_tr)
```

Design (RCT/QED):

```{r}
rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ design)
```

Control (BAU/ALT):

```{r}
rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ control)
```

Duration:

```{r}
rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ avghrs)
```

---

<br/>

#### Reading Comprehension

Measure type (Custom distal, Standardized):

```{r}
rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ type)
```

Location outside of the U.S.:

```{r}
rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ outside_us)
```

Students from low-income backgrounds included:

```{r}
rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ low_income_included)
```

Students learning a second or other language included:

```{r}
rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ second_lang_included)
```

Students with disabilities included:

```{r}
rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ stu_disability_included)
```

Grade level K-2 vs. 3-5:

```{r}
rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ grade)
```

Pedagogical Orientation: Behavorial, Cognitive, Constructivist:

```{r}
rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ pedagogy)
```

Technology Only (T) or Technology Plus (T+):

```{r}
rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ tech_plus1)
```

Type of technology (CAI, ER, Other):

```{r}
rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ typetech)
```


Gamification Discussed (yes/no):

```{r}
rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ gamification)
```

Adaptivity Discussed (yes/no):

```{r}
rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ adaptivity)
```

Feedback Discussed (yes/no):

```{r}
rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ feedback)
```

Instructional Context:

```{r}
rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ instructional_context)
```

Teacher Training Discussed:

```{r}
rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ teach_tr)
```

Design (RCT/QED):

```{r}
rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ design)
```

Control (BAU/ALT):

```{r}
rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ control)
```

Duration:

```{r}
rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ avghrs)
```


---

<br/>

#### Language-focused

Measure type (Custom distal, Custom proximal, Standardized):

```{r}
rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ type)
```


Location outside of the U.S.:

```{r}
rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ outside_us)
```

Students from low-income backgrounds included:

```{r}
rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ low_income_included)
```

Students learning a second or other language included:

```{r}
rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ second_lang_included)
```

Students with disabilities included:

```{r}
rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ stu_disability_included)
```

Grade level K-2 vs. 3-5:

```{r}
rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ grade)
```

Pedagogical Orientation: Behavorial, Cognitive, Constructivist:

```{r}
rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ pedagogy)
```

Technology Only (T) or Technology Plus (T+):

```{r}
rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ tech_plus1)
```

Type of technology (CAI, ER, Other):

```{r}
rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ typetech)
```


Gamification Discussed (yes/no):

```{r}
rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ gamification)
```

Adaptivity Discussed (yes/no):

```{r}
rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ adaptivity)
```

Feedback Discussed (yes/no):

```{r}
rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ feedback)
```

Instructional Context:

```{r}
rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ instructional_context)
```

Teacher Training Discussed:

```{r}
rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ teach_tr)
```

Design (RCT/QED):

```{r}
rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ design)
```

Control (BAU/ALT):

```{r}
rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ control)
```

Duration:

```{r}
rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ avghrs)
```


---

<br/>

#### Writing

Measure type (Custom distal, Standardized):

```{r}
rma(yi = ES, vi = EV, data = df_w, method = "REML", mods = ~ type)
```

Location outside of the U.S.:

```{r}
rma(yi = ES, vi = EV, data = df_w, method = "REML", mods = ~ outside_us)
```

Students from low-income backgrounds included:

```{r}
rma(yi = ES, vi = EV, data = df_w, method = "REML", mods = ~ low_income_included)
```

Students learning a second or other language included:

```{r}
rma(yi = ES, vi = EV, data = df_w, method = "REML", mods = ~ second_lang_included)
```

Students with disabilities included:

```{r}
rma(yi = ES, vi = EV, data = df_w, method = "REML", mods = ~ stu_disability_included)
```

Grade level K-2 vs. 3-5:

```{r}
rma(yi = ES, vi = EV, data = df_w, method = "REML", mods = ~ grade)
```

Pedagogical Orientation: Behavorial, Cognitive, Constructivist:

```{r}
rma(yi = ES, vi = EV, data = df_w, method = "REML", mods = ~ pedagogy)
```

Technology Only (T) or Technology Plus (T+):

```{r}
rma(yi = ES, vi = EV, data = df_w, method = "REML", mods = ~ tech_plus1)
```

Type of technology (CAI, ER, Other):

```{r}
rma(yi = ES, vi = EV, data = df_w, method = "REML", mods = ~ typetech)
```


Gamification Discussed (yes/no):

```{r}
rma(yi = ES, vi = EV, data = df_w, method = "REML", mods = ~ gamification)
```

Adaptivity Discussed (yes/no):

```{r}
rma(yi = ES, vi = EV, data = df_w, method = "REML", mods = ~ adaptivity)
```

Feedback Discussed (yes/no):

```{r}
rma(yi = ES, vi = EV, data = df_w, method = "REML", mods = ~ feedback)
```

Instructional Context:

```{r}
rma(yi = ES, vi = EV, data = df_w, method = "REML", mods = ~ instructional_context)
```

Teacher Training Discussed:

```{r}
rma(yi = ES, vi = EV, data = df_w, method = "REML", mods = ~ teach_tr)
```

Design (RCT/QED):

```{r}
rma(yi = ES, vi = EV, data = df_w, method = "REML", mods = ~ design)
```

Control (BAU/ALT):

```{r}
rma(yi = ES, vi = EV, data = df_w, method = "REML", mods = ~ control)
```

Duration:

```{r}
rma(yi = ES, vi = EV, data = df_w, method = "REML", mods = ~ avghrs)
```


----

<br/><br/>


## Additional Moderator Analysis

### Pairwise comparison by outcome type

**Code-related**

DRD vs DRP:

```{r}
rma(yi = ES, vi = EV, data = df_d %>% filter(type != "DSN"), method = "REML", mods = ~ type)
```


DRD vs DSN:

```{r}
rma(yi = ES, vi = EV, data = df_d %>% filter(type != "DRP"), method = "REML", mods = ~ type)
```


DSN vs DRP:

```{r}
rma(yi = ES, vi = EV, data = df_d %>% filter(type != "DRD"), method = "REML", mods = ~ type)
```

---

**Reading Comprehension**

CRD vs CSN:

```{r}
rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ type)
```

---

**Language-focused**

LRD vs LRP:

```{r}
rma(yi = ES, vi = EV, data = df_l %>% filter(type != "LSN"), method = "REML", mods = ~ type)
```


LRD vs LSN:

```{r}
rma(yi = ES, vi = EV, data = df_l %>% filter(type != "LRP"), method = "REML", mods = ~ type)
```


LSN vs LRP:

```{r}
rma(yi = ES, vi = EV, data = df_l %>% filter(type != "LRD"), method = "REML", mods = ~ type)
```

---

**Writing**

WPRD vs WPSN:

```{r}
rma(yi = ES, vi = EV, data = df_w, method = "REML", mods = ~ type)
```


---

<br/><br/>

### Time categories

**Code-related**

```{r}
rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ avghrs_categories)
```


**Reading Comprehension**

```{r}
rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ avghrs_categories)
```


**Language-focused**

```{r}
rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ avghrs_categories)
```


**Writing**

```{r}
rma(yi = ES, vi = EV, data = df_w, method = "REML", mods = ~ avghrs_categories)
```

---


### Time Continuous

**Code-related**

```{r}
rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ avghrs)
```


**Reading Comprehension**

```{r}
rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ avghrs)
```


**Language-focused**

```{r}
rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ avghrs)
```


**Writing**

```{r}
rma(yi = ES, vi = EV, data = df_w, method = "REML", mods = ~ avghrs)
```


---

### Time categories pairwise contrasts

**Code-related**

Low vs Medium:

```{r}
rma(yi = ES, vi = EV, data = df_d %>% filter(avghrs_categories != "High"), method = "REML", mods = ~ avghrs_categories)
```

Medium vs High:

```{r}
rma(yi = ES, vi = EV, data = df_d %>% filter(avghrs_categories != "Low"), method = "REML", mods = ~ avghrs_categories)
```

High vs Low:

```{r}
rma(yi = ES, vi = EV, data = df_d %>% filter(avghrs_categories != "Medium"), method = "REML", mods = ~ avghrs_categories)
```

----

**Reading Comprehension**

Low vs Medium:

```{r}
rma(yi = ES, vi = EV, data = df_c %>% filter(avghrs_categories != "High"), method = "REML", mods = ~ avghrs_categories)
```

Medium vs High:

```{r}
rma(yi = ES, vi = EV, data = df_c %>% filter(avghrs_categories != "Low"), method = "REML", mods = ~ avghrs_categories)
```

High vs Low:

```{r}
rma(yi = ES, vi = EV, data = df_c %>% filter(avghrs_categories != "Medium"), method = "REML", mods = ~ avghrs_categories)
```

----

**Language-focused**

Low vs Medium:

```{r}
rma(yi = ES, vi = EV, data = df_l %>% filter(avghrs_categories != "High"), method = "REML", mods = ~ avghrs_categories)
```

Medium vs High:

```{r}
rma(yi = ES, vi = EV, data = df_l %>% filter(avghrs_categories != "Low"), method = "REML", mods = ~ avghrs_categories)
```

High vs Low:

```{r}
rma(yi = ES, vi = EV, data = df_l %>% filter(avghrs_categories != "Medium"), method = "REML", mods = ~ avghrs_categories)
```

----

**Writing**

Low vs Medium:

```{r}
rma(yi = ES, vi = EV, data = df_w %>% filter(avghrs_categories != "High"), method = "REML", mods = ~ avghrs_categories)
```

Medium vs High:

```{r}
rma(yi = ES, vi = EV, data = df_w %>% filter(avghrs_categories != "Low"), method = "REML", mods = ~ avghrs_categories)
```

High vs Low:

```{r}
rma(yi = ES, vi = EV, data = df_w %>% filter(avghrs_categories != "Medium"), method = "REML", mods = ~ avghrs_categories)
```


----

<br/><br/>


### Multiple Meta Regressions

**Code-related**

```{r, results='asis'}
lm1 <- rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ design)

lm2 <- rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ design + type)

lm3 <- rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ design + type + avghrs_categories)

lm4 <- rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ design + type + avghrs_categories + pedagogy)

lm5 <- rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ design + type + avghrs_categories + pedagogy + grade)

lm6 <- rma(yi = ES, vi = EV, data = df_d, method = "REML", mods = ~ design + type + avghrs_categories + pedagogy + grade + low_income_included)

knitreg(list(lm1, lm2, lm3, lm4, lm5, lm6), stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, digits = 3, caption = "")
```


**Reading Comprehension**

```{r, results='asis'}
lm1 <- rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ design)

lm2 <- rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ design + type)

lm3 <- rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ design + type + avghrs_categories)

lm4 <- rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ design + type + avghrs_categories + pedagogy)

lm5 <- rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ design + type + avghrs_categories + pedagogy + grade)

lm6 <- rma(yi = ES, vi = EV, data = df_c, method = "REML", mods = ~ design + type + avghrs_categories + pedagogy + grade + low_income_included)

knitreg(list(lm1, lm2, lm3, lm4, lm5, lm6), stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, digits = 3, caption = "")
```


**Language-focused**

```{r, results='asis'}
lm1 <- rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ design)

lm2 <- rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ design + type)

lm3 <- rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ design + type + avghrs_categories)

lm4 <- rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ design + type + avghrs_categories + pedagogy)

lm5 <- rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ design + type + avghrs_categories + pedagogy + grade)

lm6 <- rma(yi = ES, vi = EV, data = df_l, method = "REML", mods = ~ design + type + avghrs_categories + pedagogy + grade + low_income_included)

knitreg(list(lm1, lm2, lm3, lm4, lm5, lm6), stars = c(0.01, 0.05, 0.1), include.ci = FALSE, dcolumn = TRUE, booktabs = TRUE, digits = 3, caption = "")
```

----

<br/><br/>

### Pedagogy pairwise contrasts

**Code-related**

Pedagogical Orientation: Behavorial vs Cognitive

```{r}
rma(yi = ES, vi = EV, data = df_d %>% filter(pedagogy != "Constructivist"), method = "REML", mods = ~ pedagogy)
```

Pedagogical Orientation: Behavorial vs Constructivist

```{r}
rma(yi = ES, vi = EV, data = df_d %>% filter(pedagogy != "Cognitive"), method = "REML", mods = ~ pedagogy)
```

Pedagogical Orientation: Cognitive vs Constructivist

```{r}
rma(yi = ES, vi = EV, data = df_d %>% filter(pedagogy != "Behavioral"), method = "REML", mods = ~ pedagogy)
```

----

**Language-focused**

Pedagogical Orientation: Behavorial vs Cognitive

```{r}
rma(yi = ES, vi = EV, data = df_l %>% filter(pedagogy != "Constructivist"), method = "REML", mods = ~ pedagogy)
```

Pedagogical Orientation: Behavorial vs Constructivist

```{r}
rma(yi = ES, vi = EV, data = df_l %>% filter(pedagogy != "Cognitive"), method = "REML", mods = ~ pedagogy)
```

Pedagogical Orientation: Cognitive vs Constructivist

```{r}
rma(yi = ES, vi = EV, data = df_l %>% filter(pedagogy != "Behavioral"), method = "REML", mods = ~ pedagogy)
```

----



## Publication Bias

### Funnel Plots

Code-related:


```{r, fig.retina=4}
df_d %>%
  rma(
    yi = ES,
    vi = EV,
    data = .,
    mods = ~ type,
    method = "REML"
  ) %>%
  funnel(xlab = "Code-related Effect Size", pch = 21, bg = "grey")
```


Reading Comprehension:

```{r, fig.retina=4}
df_c %>%
  rma(
    yi = ES,
    vi = EV,
    data = .,
    mods = ~ type,
    method = "REML"
  ) %>%
  funnel(xlab = "Reading Comprehension Effect Size", pch = 21, bg = "grey")
```

Language-focused:


```{r, fig.retina=4}
df_l %>%
  rma(
    yi = ES,
    vi = EV,
    data = .,
    mods = ~ type,
    method = "REML"
  ) %>%
  funnel(xlab = "Language Focused Effect Size", pch = 21, bg = "grey")
```

Writing:


```{r, fig.retina=4}
df_w %>%
  rma(
    yi = ES,
    vi = EV,
    data = .,
    mods = ~ type,
    method = "REML"
  ) %>%
  funnel(xlab = "Writing Effect Size", pch = 21, bg = "grey")
```

### Egger's Tests

Code-related:

```{r}
x <-
  df_d %>%
  rma(
    yi = ES,
    vi = EV,
    data = .,
    mods = ~ type,
    method = "REML"
  )

regtest(x, model = "rma", predictor = "sei")
```

Reading Comprehension:

```{r}
x <-
  df_c %>%
  rma(
    yi = ES,
    vi = EV,
    data = .,
    mods = ~ type,
    method = "REML"
  )

regtest(x, model = "rma", predictor = "sei")
```

Language-focused:

```{r}
x <-
  df_l %>%
  rma(
    yi = ES,
    vi = EV,
    data = .,
    mods = ~ type,
    method = "REML"
  )

regtest(x, model = "rma", predictor = "sei")
```

Writing:

```{r}
x <-
  df_w %>%
  rma(
    yi = ES,
    vi = EV,
    data = .,
    mods = ~ type,
    method = "REML"
  )

regtest(x, model = "rma", predictor = "sei")
```

### P-curves

Code-related:

```{r}
df_d %>%
  mutate(
    SE = sqrt(EV)
  ) %>%
  meta::metagen(
    ES,
    SE,
    data = .,
    comb.fixed = F,
    comb.random = T,
    method.tau = "REML",
    hakn = T,
    sm = "SMD"
  ) %>%
  pcurve()
```

Reading Comprehension:

```{r}
df_c %>%
  mutate(
    SE = sqrt(EV)
  ) %>%
  meta::metagen(
    ES,
    SE,
    data = .,
    comb.fixed = F,
    comb.random = T,
    method.tau = "REML",
    hakn = T,
    sm = "SMD"
  ) %>%
  pcurve()
```

Language-focused:

```{r}
df_l %>%
  mutate(
    SE = sqrt(EV)
  ) %>%
  meta::metagen(
    ES,
    SE,
    data = .,
    comb.fixed = F,
    comb.random = T,
    method.tau = "REML",
    hakn = T,
    sm = "SMD"
  ) %>%
  pcurve()
```

Writing:

```{r}
df_w %>%
  mutate(
    SE = sqrt(EV)
  ) %>%
  meta::metagen(
    ES,
    SE,
    data = .,
    comb.fixed = F,
    comb.random = T,
    method.tau = "REML",
    hakn = T,
    sm = "SMD"
  ) %>%
  pcurve()
```


---

<br/><br/>

## Sensitivity analyses

### Exclude high selection risk studies [Keep RCTs only]

Code-related:

```{r}
df_d %>%
  filter(design == "RCT") %>%
  rma(
    yi = ES,
    vi = EV,
    data = .,
    method = "REML"
  )
```


Reading Comprehension:

```{r}
df_c %>%
  filter(design == "RCT") %>%
  rma(
    yi = ES,
    vi = EV,
    data = .,
    method = "REML"
  )
```



Language-focused:


```{r}
df_l %>%
  filter(design == "RCT") %>%
  rma(
    yi = ES,
    vi = EV,
    data = .,
    method = "REML"
  )
```


Writing:


```{r}
df_w %>%
  filter(design == "RCT") %>%
  rma(
    yi = ES,
    vi = EV,
    data = .,
    method = "REML"
  )
```


---

### Constrain outliers by Winsorizing

Code-related:

```{r}
df_d %>%
  mutate(
    ES = DescTools::Winsorize(ES)
  ) %>%
  rma(
    yi = ES,
    vi = EV,
    data = .,
    method = "REML"
  )
```



Reading Comprehension:

```{r}
df_c %>%
  mutate(
    ES = DescTools::Winsorize(ES)
  ) %>%
  rma(
    yi = ES,
    vi = EV,
    data = .,
    method = "REML"
  )
```



Language-focused:


```{r}
df_l %>%
  mutate(
    ES = DescTools::Winsorize(ES)
  ) %>%
  rma(
    yi = ES,
    vi = EV,
    data = .,
    method = "REML"
  )
```



Writing:


```{r}
df_w %>%
  mutate(
    ES = DescTools::Winsorize(ES)
  ) %>%
  rma(
    yi = ES,
    vi = EV,
    data = .,
    method = "REML"
  )
```

---

<br/><br/>

### Changing within study correlations (when aggregating effect sizes within a study)

#### Code-related

_r = 0:_

```{r}
df_append %>%
  unite("type_stdid", c("type", "stdid")) %>% 
  agg(id = type_stdid, es = ES, var = EV, method = "BHHR", data = ., cor = 0) %>% 
  separate(id, c("type", "stdid")) %>% 
  rename(ES = es, EV = var) %>% 
  filter(str_detect(type, "^D")) %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    digits = 2
  )
```

_r = 0.4:_

```{r}
df_append %>%
  unite("type_stdid", c("type", "stdid")) %>% 
  agg(id = type_stdid, es = ES, var = EV, method = "BHHR", data = ., cor = 0.4) %>% 
  separate(id, c("type", "stdid")) %>% 
  rename(ES = es, EV = var) %>% 
  filter(str_detect(type, "^D")) %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    digits = 2
  )
```

_r = 0.8:_

```{r}
df_append %>%
  unite("type_stdid", c("type", "stdid")) %>% 
  agg(id = type_stdid, es = ES, var = EV, method = "BHHR", data = ., cor = 0.8) %>% 
  separate(id, c("type", "stdid")) %>% 
  rename(ES = es, EV = var) %>% 
  filter(str_detect(type, "^D")) %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    digits = 2
  )
```


#### Reading Comprehension

_r = 0:_

```{r}
df_append %>%
  unite("type_stdid", c("type", "stdid")) %>% 
  agg(id = type_stdid, es = ES, var = EV, method = "BHHR", data = ., cor = 0) %>% 
  separate(id, c("type", "stdid")) %>% 
  rename(ES = es, EV = var) %>% 
  filter(str_detect(type, "^C")) %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    digits = 2
  )
```

_r = 0.4:_

```{r}
df_append %>%
  unite("type_stdid", c("type", "stdid")) %>% 
  agg(id = type_stdid, es = ES, var = EV, method = "BHHR", data = ., cor = 0.4) %>% 
  separate(id, c("type", "stdid")) %>% 
  rename(ES = es, EV = var) %>% 
  filter(str_detect(type, "^C")) %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    digits = 2
  )
```

_r = 0.8:_

```{r}
df_append %>%
  unite("type_stdid", c("type", "stdid")) %>% 
  agg(id = type_stdid, es = ES, var = EV, method = "BHHR", data = ., cor = 0.8) %>% 
  separate(id, c("type", "stdid")) %>% 
  rename(ES = es, EV = var) %>% 
  filter(str_detect(type, "^C")) %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    digits = 2
  )
```


#### Language-focused

_r = 0:_

```{r}
df_append %>%
  unite("type_stdid", c("type", "stdid")) %>% 
  agg(id = type_stdid, es = ES, var = EV, method = "BHHR", data = ., cor = 0) %>% 
  separate(id, c("type", "stdid")) %>% 
  rename(ES = es, EV = var) %>% 
  filter(str_detect(type, "^L")) %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    digits = 2
  )
```

_r = 0.4:_

```{r}
df_append %>%
  unite("type_stdid", c("type", "stdid")) %>% 
  agg(id = type_stdid, es = ES, var = EV, method = "BHHR", data = ., cor = 0.4) %>% 
  separate(id, c("type", "stdid")) %>% 
  rename(ES = es, EV = var) %>% 
  filter(str_detect(type, "^L")) %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    digits = 2
  )
```

_r = 0.8:_

```{r}
df_append %>%
  unite("type_stdid", c("type", "stdid")) %>% 
  agg(id = type_stdid, es = ES, var = EV, method = "BHHR", data = ., cor = 0.8) %>% 
  separate(id, c("type", "stdid")) %>% 
  rename(ES = es, EV = var) %>% 
  filter(str_detect(type, "^L")) %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    digits = 2
  )
```


#### Writing

_r = 0:_

```{r}
df_append %>%
  unite("type_stdid", c("type", "stdid")) %>% 
  agg(id = type_stdid, es = ES, var = EV, method = "BHHR", data = ., cor = 0) %>% 
  separate(id, c("type", "stdid")) %>% 
  rename(ES = es, EV = var) %>% 
  filter(str_detect(type, "^W")) %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    digits = 2
  )
```

_r = 0.4:_

```{r}
df_append %>%
  unite("type_stdid", c("type", "stdid")) %>% 
  agg(id = type_stdid, es = ES, var = EV, method = "BHHR", data = ., cor = 0.4) %>% 
  separate(id, c("type", "stdid")) %>% 
  rename(ES = es, EV = var) %>% 
  filter(str_detect(type, "^W")) %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    digits = 2
  )
```

_r = 0.8:_

```{r}
df_append %>%
  unite("type_stdid", c("type", "stdid")) %>% 
  agg(id = type_stdid, es = ES, var = EV, method = "BHHR", data = ., cor = 0.8) %>% 
  separate(id, c("type", "stdid")) %>% 
  rename(ES = es, EV = var) %>% 
  filter(str_detect(type, "^W")) %>% 
  rma(
    yi = ES, 
    vi = EV, 
    data = ., 
    method = "REML",
    digits = 2
  )
```


